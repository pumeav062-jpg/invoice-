<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice OS - Live</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and Babel for functionality -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@400;700;900&display=swap');
        body { font-family: 'Kantumruy Pro', sans-serif; }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [view, setView] = useState('editor');
            const [invoice, setInvoice] = useState({
                number: "INV-" + Math.floor(Math.random() * 900000 + 100000),
                date: new Date().toISOString().split('T')[0],
                from: "",
                to: "",
                items: [{ desc: "", qty: 1, price: 0 }],
                currency: 'USD',
                rate: 4100,
                status: 'Unpaid'
            });

            const updateItem = (i, field, val) => {
                const newItems = [...invoice.items];
                newItems[i][field] = field === 'desc' ? val : Number(val);
                setInvoice({ ...invoice, items: newItems });
            };

            const total = invoice.items.reduce((acc, item) => acc + (item.qty * item.price), 0);
            const format = (val, cur) => cur === 'USD' ? `$${val.toLocaleString()}` : `៛${(val * (invoice.currency === 'USD' ? invoice.rate : 1)).toLocaleString()}`;

            return (
                <div className="min-h-screen flex flex-col">
                    {/* Header */}
                    <nav className="bg-white border-b p-4 flex justify-between items-center no-print sticky top-0 z-50">
                        <div className="flex items-center gap-4">
                            <h1 className="font-black text-blue-600 text-xl">INVOICE OS</h1>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => window.print()} className="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold text-sm">បោះពុម្ព (Print)</button>
                        </div>
                    </nav>

                    <div className="p-4 md:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
                        {/* Control Side */}
                        <div className="lg:col-span-4 space-y-4 no-print">
                            <div className="bg-white p-6 rounded-2xl shadow-sm border space-y-4">
                                <h2 className="font-black text-slate-800 border-b pb-2">ការកំណត់</h2>
                                
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="space-y-1">
                                        <label className="text-[10px] font-bold text-slate-400">រូបិយប័ណ្ណ</label>
                                        <select className="w-full border p-2 rounded-lg text-sm bg-slate-50" value={invoice.currency} onChange={e => setInvoice({...invoice, currency: e.target.value})}>
                                            <option value="USD">USD ($)</option>
                                            <option value="KHR">KHR (៛)</option>
                                        </select>
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-[10px] font-bold text-slate-400">ស្ថានភាព</label>
                                        <select className="w-full border p-2 rounded-lg text-sm bg-slate-50" value={invoice.status} onChange={e => setInvoice({...invoice, status: e.target.value})}>
                                            <option value="Unpaid">ជំពាក់ (Unpaid)</option>
                                            <option value="Paid">បង់រួច (Paid)</option>
                                        </select>
                                    </div>
                                </div>

                                <div className="space-y-1">
                                    <label className="text-[10px] font-bold text-slate-400">ឈ្មោះអតិថិជន</label>
                                    <input className="w-full border p-2 rounded-lg text-sm" placeholder="ឈ្មោះអតិថិជន..." value={invoice.to} onChange={e => setInvoice({...invoice, to: e.target.value})} />
                                </div>

                                <div className="space-y-2">
                                    <label className="text-[10px] font-bold text-slate-400">មុខទំនិញ</label>
                                    {invoice.items.map((item, i) => (
                                        <div key={i} className="flex gap-2">
                                            <input className="flex-grow border p-2 rounded-lg text-xs" placeholder="ទំនិញ" value={item.desc} onChange={e => updateItem(i, 'desc', e.target.value)} />
                                            <input type="number" className="w-12 border p-2 rounded-lg text-xs" value={item.qty} onChange={e => updateItem(i, 'qty', e.target.value)} />
                                            <input type="number" className="w-20 border p-2 rounded-lg text-xs" value={item.price} onChange={e => updateItem(i, 'price', e.target.value)} />
                                        </div>
                                    ))}
                                    <button onClick={() => setInvoice({...invoice, items: [...invoice.items, {desc: "", qty: 1, price: 0}]})} className="w-full bg-slate-100 py-2 rounded-lg text-[10px] font-bold text-slate-500 hover:bg-slate-200">+ បន្ថែមទំនិញ</button>
                                </div>
                            </div>
                        </div>

                        {/* Preview Side */}
                        <div className="lg:col-span-8 flex justify-center">
                            <div className="bg-white w-full max-w-[800px] min-h-[1000px] p-12 border shadow-lg relative rounded-lg">
                                {/* Paid Stamp */}
                                {invoice.status === 'Paid' && (
                                    <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 border-[15px] border-green-500/20 text-green-500/20 text-9xl font-black rounded-full p-20 -rotate-12 pointer-events-none select-none uppercase">PAID</div>
                                )}

                                <div className="flex justify-between items-start mb-16">
                                    <div>
                                        <h1 className="text-4xl font-black text-blue-600 mb-2">INVOICE</h1>
                                        <p className="text-sm text-slate-500">វិក្កយបត្រលក់ទំនិញ</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-xs font-bold text-slate-400">លេខវិក្កយបត្រ</p>
                                        <p className="font-bold">#{invoice.number}</p>
                                        <p className="text-xs font-bold text-slate-400 mt-2">កាលបរិច្ឆេទ</p>
                                        <p className="font-bold">{invoice.date}</p>
                                    </div>
                                </div>

                                <div className="mb-12 border-l-4 border-blue-600 pl-6 py-2 bg-blue-50/50 rounded-r-xl">
                                    <p className="text-[10px] font-bold text-blue-600 uppercase tracking-widest mb-1">ផ្ញើជូន (Bill To)</p>
                                    <p className="text-2xl font-black text-slate-800">{invoice.to || "ឈ្មោះអតិថិជន"}</p>
                                </div>

                                <table className="w-full mb-12">
                                    <thead className="border-b-2 border-slate-900">
                                        <tr>
                                            <th className="py-4 text-left text-[10px] font-bold uppercase text-slate-400">ឈ្មោះទំនិញ</th>
                                            <th className="py-4 text-center text-[10px] font-bold uppercase text-slate-400 w-24">ចំនួន</th>
                                            <th className="py-4 text-right text-[10px] font-bold uppercase text-slate-400 w-32">តម្លៃរាយ</th>
                                            <th className="py-4 text-right text-[10px] font-bold uppercase text-slate-900 w-40">សរុប</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y">
                                        {invoice.items.map((item, i) => (
                                            <tr key={i}>
                                                <td className="py-5 font-bold text-slate-800">{item.desc || "..."}</td>
                                                <td className="py-5 text-center text-slate-500">{item.qty}</td>
                                                <td className="py-5 text-right text-slate-500">{format(item.price, invoice.currency)}</td>
                                                <td className="py-5 text-right font-black text-slate-900">{format(item.qty * item.price, invoice.currency)}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>

                                <div className="flex justify-end pt-8">
                                    <div className="w-80 space-y-3">
                                        <div className="flex justify-between items-center px-4">
                                            <span className="text-[10px] font-bold text-slate-400 uppercase">សរុបដុល្លារ (Total USD)</span>
                                            <span className="font-bold text-slate-600">{format(total, 'USD')}</span>
                                        </div>
                                        <div className="bg-blue-600 text-white p-6 rounded-2xl shadow-xl flex justify-between items-center">
                                            <span className="text-xs font-black uppercase opacity-70 tracking-widest">សរុបរួម</span>
                                            <span className="text-3xl font-black">{format(total, invoice.currency)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

